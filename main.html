<!DOCTYPE html>
<html>
  <head>

    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>My Weather App</title>
    <script
      src="https://code.jquery.com/jquery-2.2.4.min.js"
      integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
      crossorigin="anonymous">
    </script>
  </head>

  <body>

    <script>
      // get user location
      $.getJSON("http://ip-api.com/json/?fields=city,country,lat,lon", function getUserLocation(data) {
        $('#city').html(data.city);
        $('#country').html(data.country);
        var lat = data.lat;  // declare latitude
        var lon = data.lon; // declare longtitude
        
          // get local weather data
          function getWeatherData(lat, lon) {
            //lat and lon are "undefined" in this function.  Why?
            var apiKey = "7b3519746f900ef3c719c52691caf255";
            var exclude = "?exclude=minutely,hourly,daily,alerts,flags";
            var unit ="?units=si";
            var url = "https://api.darksky.net/forecast/" + apiKey + "/" + lat + "," + lon + exclude + unit; 
                
            $.ajax({
              url: url,
              dataType: "jsonp",
              success: function(weatherData) {
                $('#currentWeather').text(weatherData.currently.summary)
                $('#currentTemp').val(weatherData.currently.temperature);
                //console.log(url);  // lat & lon are undefined within the url.
              }
            });
          }
        getWeatherData();
        //console.log(lat);  //lat is defined!
      });
    </script>

    <div id="city"></div>
    <div id="country"></div>
    <div id="currentWeather"></div>
    <div id="currentTemp"></div>

  </body>
</html>
